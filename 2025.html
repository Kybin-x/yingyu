<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2025å¹´å¹¿ä¸œé«˜èŒé«˜è€ƒè‹±è¯­æ™ºèƒ½è®­ç»ƒç³»ç»Ÿ (å¢å¼ºç‰ˆ)</title>
    <style>
        :root {
            --primary-color: #4a90e2;       /* ä¸»è‰²è°ƒï¼šæŸ”å’Œè“ */
            --secondary-color: #2c3e50;     /* ä¾§è¾¹æ æ·±è‰² */
            --accent-color: #f39c12;        /* å¼ºè°ƒè‰²ï¼šæ©™é»„ */
            --success-color: #27ae60;       /* æˆåŠŸç»¿ */
            --error-color: #e74c3c;         /* é”™è¯¯çº¢ */
            --bg-color: #f4f7f6;            /* èƒŒæ™¯ç° */
            --sidebar-width: 260px;
        }

        body {
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
            margin: 0;
            background-color: var(--bg-color);
            color: #333;
            display: flex;
            height: 100vh;
            overflow: hidden;
            font-size: 18px; /* 1) è°ƒæ•´å­—ä½“å¤§å°ï¼Œæ•´ä½“å˜å¤§ */
            line-height: 1.6;
        }

        /* ç™»å½•é®ç½© */
        #login-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(44, 62, 80, 0.98);
            z-index: 9999;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .login-box {
            background: white;
            padding: 50px;
            border-radius: 15px;
            width: 400px;
            text-align: center;
            box-shadow: 0 15px 40px rgba(0,0,0,0.4);
        }

        .login-box h2 { margin-top: 0; color: var(--secondary-color); font-size: 24px; }

        .login-box input {
            width: 100%;
            padding: 15px;
            margin: 15px 0;
            border: 2px solid #eee;
            border-radius: 8px;
            box-sizing: border-box;
            font-size: 18px;
            transition: border-color 0.3s;
        }
        .login-box input:focus { border-color: var(--primary-color); outline: none; }

        /* ä¾§è¾¹æ  */
        .sidebar {
            width: var(--sidebar-width);
            background-color: var(--secondary-color);
            color: #ecf0f1;
            display: flex;
            flex-direction: column;
            box-shadow: 4px 0 10px rgba(0,0,0,0.1);
            z-index: 10;
        }

        .user-info-display {
            padding: 30px 20px;
            background: rgba(0,0,0,0.2);
            border-bottom: 1px solid #3e5871;
        }
        .user-info-display h3 { margin: 0; font-size: 20px; }
        .user-info-display p { margin: 10px 0 0; font-size: 14px; opacity: 0.8; }

        .menu-item {
            padding: 20px 25px;
            cursor: pointer;
            transition: all 0.2s;
            border-left: 6px solid transparent;
            font-size: 16px;
        }
        .menu-item:hover { background-color: #34495e; }
        .menu-item.active { 
            background-color: #2980b9; 
            border-left-color: var(--accent-color);
            font-weight: bold;
        }

        /* ä¸»å†…å®¹åŒº */
        .main-content {
            flex: 1;
            padding: 40px;
            overflow-y: auto;
            position: relative;
            scroll-behavior: smooth;
        }

        /* é¢˜ç›®å¡ç‰‡ */
        .question-card {
            background: white;
            padding: 30px;
            margin-bottom: 25px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.06);
            border: 1px solid #eee;
            position: relative;
        }

        .q-title { 
            font-weight: 600; 
            margin-bottom: 20px; 
            font-size: 1.05em; 
            color: #2c3e50;
        }

        /* é€‰é¡¹æ ·å¼ */
        .options-group { display: grid; gap: 15px; }
        .option-btn {
            text-align: left;
            padding: 15px 20px;
            background: #f9fbfd;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.2s;
            color: #555;
        }
        .option-btn:hover:not(:disabled) { background: #eef2f7; border-color: #dbe2e8; }
        
        .option-btn.correct { 
            background-color: #d4edda; 
            border-color: var(--success-color); 
            color: #155724; 
            font-weight: bold;
        }
        .option-btn.wrong { 
            background-color: #f8d7da; 
            border-color: var(--error-color); 
            color: #721c24; 
        }

        /* åˆ†å±å¸ƒå±€ */
        .split-layout {
            display: flex;
            gap: 40px;
            align-items: flex-start;
            height: calc(100vh - 100px); /* é™åˆ¶é«˜åº¦ä»¥ä¾¿å†…éƒ¨æ»šåŠ¨ */
        }
        .passage-panel {
            flex: 1;
            background: #fff;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.06);
            overflow-y: auto;
            height: 100%;
            border-top: 5px solid var(--primary-color);
            line-height: 1.8;
            font-size: 17px;
        }
        .questions-panel { 
            flex: 1; 
            overflow-y: auto; 
            height: 100%;
            padding-right: 10px; 
        }

        /* 3) ç¿»è¯‘æŠ˜å åŠŸèƒ½ */
        .trans-toggle-btn {
            display: inline-block;
            margin-top: 8px;
            padding: 4px 10px;
            font-size: 14px;
            color: var(--primary-color);
            background: rgba(74, 144, 226, 0.1);
            border-radius: 4px;
            cursor: pointer;
            user-select: none;
        }
        .trans-toggle-btn:hover { background: rgba(74, 144, 226, 0.2); }
        
        .para-trans {
            display: none; /* é»˜è®¤éšè— */
            margin-top: 10px;
            padding: 15px;
            background-color: #fff9e6;
            border-left: 4px solid var(--accent-color);
            border-radius: 0 4px 4px 0;
            color: #5d5d5d;
            font-size: 0.95em;
        }

        /* åµŒå…¥å¼è¾“å…¥æ¡† */
        .inline-input {
            border: none;
            border-bottom: 2px solid #95a5a6;
            width: 140px;
            text-align: center;
            font-size: 18px;
            padding: 5px;
            background: #f4f6f9;
            color: #333;
            margin: 0 5px;
            border-radius: 4px 4px 0 0;
            transition: all 0.3s;
        }
        .inline-input:focus { outline: none; border-bottom-color: var(--primary-color); background: #e8f0fe; }
        .inline-input.correct { border-bottom-color: var(--success-color); color: var(--success-color); font-weight: bold; background: white;}
        .inline-input.wrong { border-bottom-color: var(--error-color); color: var(--error-color); background: #fff0f0;}

        /* è§£æåŒºåŸŸ */
        .analysis-box {
            margin-top: 20px;
            padding: 20px;
            background: #f1f9ff;
            border-left: 5px solid var(--primary-color);
            border-radius: 0 8px 8px 0;
            display: none;
            font-size: 16px;
            color: #444;
        }
        .analysis-label { font-weight: bold; color: var(--secondary-color); margin-right: 5px; }

        .check-btn {
            background: var(--secondary-color);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            transition: background 0.3s;
        }
        .check-btn:hover { background: #34495e; }

        /* æäº¤æŒ‰é’® */
        .submit-all-btn {
            position: fixed;
            bottom: 30px;
            right: 40px;
            background: var(--success-color);
            color: white;
            border: none;
            padding: 16px 40px;
            border-radius: 50px;
            font-size: 20px;
            box-shadow: 0 8px 25px rgba(39, 174, 96, 0.4);
            cursor: pointer;
            z-index: 100;
            transition: transform 0.2s;
        }
        .submit-all-btn:hover { transform: scale(1.05); }

        /* ç»“æœå¼¹çª— */
        .modal-overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.6);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            backdrop-filter: blur(5px);
        }
        .result-card {
            background: white;
            padding: 40px;
            border-radius: 15px;
            text-align: center;
            width: 450px;
            animation: slideUp 0.4s ease;
        }
        @keyframes slideUp { from { transform: translateY(50px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        
        .score-num { font-size: 60px; color: var(--primary-color); font-weight: bold; display: block; margin: 20px 0; }
        .result-btns { display: flex; gap: 15px; justify-content: center; margin-top: 30px; }
        .res-btn { flex: 1; padding: 12px; border: none; border-radius: 8px; font-size: 16px; cursor: pointer; color: white; }
        .btn-retry { background: var(--accent-color); }
        .btn-restart { background: var(--secondary-color); }

        textarea { width: 100%; height: 150px; padding: 15px; border: 1px solid #ccc; border-radius: 8px; margin-top: 15px; font-size: 16px; font-family: inherit; }

    </style>
</head>
<body>

<div id="login-overlay">
    <div class="login-box">
        <h2>ğŸ“ 2025 é«˜èŒé«˜è€ƒè‹±è¯­ç‰¹è®­</h2>
        <input type="text" id="u-class" placeholder="è¯·è¾“å…¥ç­çº§">
        <input type="text" id="u-id" placeholder="è¯·è¾“å…¥å­¦å·">
        <input type="text" id="u-name" placeholder="è¯·è¾“å…¥å§“å">
        <button onclick="login()" class="check-btn" style="width:100%; margin-top:20px; background:var(--primary-color);">å¼€å§‹ç­”é¢˜</button>
    </div>
</div>

<div class="sidebar" id="sidebar" style="display:none;">
    <div class="user-info-display">
        <h3 id="disp-name">è€ƒç”Ÿ</h3>
        <p id="disp-id">--</p>
    </div>
    <div id="menu-container"></div>
</div>

<div class="main-content" id="main-area" style="display:none;">
    <div id="content-container"></div>
</div>

<button class="submit-all-btn" onclick="submitExam()">äº¤å·</button>

<div class="modal-overlay" id="result-modal">
    <div class="result-card">
        <h2>è€ƒè¯•ç»“æŸ</h2>
        <p>æ‚¨çš„ç»ƒä¹ æˆç»©ä¸º</p>
        <span class="score-num" id="final-score">0</span>
        <p style="color:#7f8c8d; font-size:0.9em;">æ»¡åˆ†ï¼š105åˆ† (ä¸å«é˜…è¯»ç†è§£)</p>
        <div class="result-btns">
            <button class="res-btn btn-retry" onclick="retryWrongMode()">åªç»ƒé”™é¢˜</button>
            <button class="res-btn btn-restart" onclick="location.reload()">é‡æ–°ç­”é¢˜</button>
        </div>
    </div>
</div>

<script>
    // --- é¢˜åº“æ•°æ® (å¢å¼ºè§£æç‰ˆ) ---
    // 2) ç­”æ¡ˆè§£ææ˜¾ç¤ºå®Œæ•´çš„ä¸­æ–‡ç¿»è¯‘ï¼ˆå·²åœ¨ exp å­—æ®µä¸­å¢å¼ºï¼‰
    const examData = [
        {
            id: 'part1',
            title: "I. è¡¥å…¨å¯¹è¯ (å•é€‰)",
            type: 'choice',
            desc: "é˜…è¯»ä¸‹åˆ—ç®€çŸ­å¯¹è¯ï¼Œä»Aã€Bã€Cã€Dä¸­é€‰å‡ºæœ€ä½³ç­”æ¡ˆã€‚",
            questions: [
                { id: 1, q: "Hello! My name is Lily.<br>- Hi, Lily. I'm Tom. ______", options: ["A. Come on.", "B. My pleasure.", "C. Go ahead.", "D. Glad to meet you."], ans: "D", exp: "<br><span class='analysis-label'>ã€å¥æ„ã€‘</span> -ä½ å¥½ï¼æˆ‘å«è‰è‰ã€‚<br>-å—¨ï¼Œè‰è‰ã€‚æˆ‘æ˜¯æ±¤å§†ã€‚å¾ˆé«˜å…´è®¤è¯†ä½ ã€‚<br><span class='analysis-label'>ã€è§£æã€‘</span> åˆæ¬¡è§é¢æ‰“æ‹›å‘¼å¸¸ç”¨ 'Glad to meet you' (å¾ˆé«˜å…´è®¤è¯†ä½ )ã€‚" },
                { id: 2, q: "Can you believe it? I've passed the exam.<br>- ______ All your efforts paid off.", options: ["A. Congratulations!", "B. You're right.", "C. Behave yourself.", "D. Take your time."], ans: "A", exp: "<br><span class='analysis-label'>ã€å¥æ„ã€‘</span> -ä½ æ•¢ä¿¡å—ï¼Ÿæˆ‘é€šè¿‡äº†è€ƒè¯•ã€‚<br>-ç¥è´ºä½ ï¼ä½ æ‰€æœ‰çš„åŠªåŠ›éƒ½å¾—åˆ°äº†å›æŠ¥ã€‚<br><span class='analysis-label'>ã€è§£æã€‘</span> å¬åˆ°å¥½æ¶ˆæ¯åº”è¡¨ç¤ºç¥è´ºï¼ŒAé€‰é¡¹æ„ä¸ºâ€œç¥è´ºï¼â€ã€‚" },
                { id: 3, q: "What a cold day! Let's get some hot drink.<br>- ______ What about the cafe around the corner?", options: ["A. Funny.", "B. Sure.", "C. No thanks, please.", "D. Don't worry."], ans: "B", exp: "<br><span class='analysis-label'>ã€å¥æ„ã€‘</span> -å¤šå†·çš„å¤©å•Šï¼æˆ‘ä»¬å»å–ç‚¹çƒ­é¥®å§ã€‚<br>-å½“ç„¶å¥½å•Šã€‚è¡—è§’çš„å’–å•¡é¦†æ€ä¹ˆæ ·ï¼Ÿ<br><span class='analysis-label'>ã€è§£æã€‘</span> åŒæ„å¯¹æ–¹æè®®ï¼Œç”¨ 'Sure' (å½“ç„¶)ã€‚" },
                { id: 4, q: "I want to try painting, but I don't have the talent.<br>- ______ It's all about having fun.", options: ["A. Not at all.", "B. Cheers.", "C. Just give it a try.", "D. You're kidding."], ans: "C", exp: "<br><span class='analysis-label'>ã€å¥æ„ã€‘</span> -æˆ‘æƒ³å°è¯•ç”»ç”»ï¼Œä½†æˆ‘æ²¡æœ‰å¤©èµ‹ã€‚<br>-å°±è¯•ä¸€è¯•å§ã€‚è¿™ä¸»è¦æ˜¯ä¸ºäº†å¥½ç©ã€‚<br><span class='analysis-label'>ã€è§£æã€‘</span> é¼“åŠ±å¯¹æ–¹å°è¯•ï¼ŒCé€‰é¡¹ 'Just give it a try' (è¯•ä¸€è¯•) ç¬¦åˆè¯­å¢ƒã€‚" },
                { id: 5, q: "- Why not put down your phone and do some exercise?<br>- ______ I'll start running tomorrow.", options: ["A. Good idea.", "B. Well done.", "C. It doesn't matter.", "D. Sorry to hear that."], ans: "A", exp: "<br><span class='analysis-label'>ã€å¥æ„ã€‘</span> -ä¸ºä»€ä¹ˆä¸æ”¾ä¸‹æ‰‹æœºå»é”»ç‚¼ä¸€ä¸‹å‘¢ï¼Ÿ<br>-å¥½ä¸»æ„ã€‚æˆ‘æ˜å¤©å¼€å§‹è·‘æ­¥ã€‚<br><span class='analysis-label'>ã€è§£æã€‘</span> èµåŒå»ºè®®ï¼ŒAé€‰é¡¹ 'Good idea' (å¥½ä¸»æ„) æœ€ä¸ºåˆé€‚ã€‚" }
            ]
        },
        {
            id: 'part2',
            title: "II. è¯æ±‡ (å•é€‰)",
            type: 'choice',
            desc: "é˜…è¯»ä¸‹åˆ—å¥å­ï¼Œé€‰å‡ºå¥ä¸­ç”»çº¿å•è¯æˆ–è¯ç»„çš„æ„ä¹‰ã€‚",
            questions: [
                { id: 6, q: "He delivered a formal <u>address</u> at the open-air meeting.", options: ["A. è‡´è¾", "B. åœ°å€", "C. æ–‡ä»¶", "D. äº§å“"], ans: "A", exp: "<span class='analysis-label'>ã€å¥æ„ã€‘</span> ä»–åœ¨éœ²å¤©ä¼šè®®ä¸Šå‘è¡¨äº†æ­£å¼è‡´è¾ã€‚<br><span class='analysis-label'>ã€è§£æã€‘</span> address åœ¨æ­¤ä½œåè¯ï¼Œæ„ä¸ºâ€œæ¼”è®²ï¼Œè‡´è¾â€ã€‚" },
                { id: 7, q: "Senior <u>consumers</u> want more information about what they buy.", options: ["A. å¿«é€’å‘˜", "B. æœåŠ¡å‘˜", "C. æ¶ˆè´¹è€…", "D. ç®¡ç†è€…"], ans: "C", exp: "<span class='analysis-label'>ã€å¥æ„ã€‘</span> è€å¹´æ¶ˆè´¹è€…æƒ³è¦æ›´å¤šå…³äºä»–ä»¬æ‰€è´­å•†å“çš„ä¿¡æ¯ã€‚<br><span class='analysis-label'>ã€è§£æã€‘</span> consumer æ„ä¸ºâ€œæ¶ˆè´¹è€…â€ã€‚" },
                { id: 8, q: "He <u>delayed</u> telling her the news, waiting for the right moment.", options: ["A. åæ‚”", "B. æ¨è¿Ÿ", "C. å¼ºè°ƒ", "D. å¿˜è®°"], ans: "B", exp: "<span class='analysis-label'>ã€å¥æ„ã€‘</span> ä»–æ¨è¿Ÿäº†å‘Šè¯‰å¥¹è¿™ä¸ªæ¶ˆæ¯ï¼Œåœ¨ç­‰å¾…åˆé€‚çš„æ—¶æœºã€‚<br><span class='analysis-label'>ã€è§£æã€‘</span> delay æ„ä¸ºâ€œæ¨è¿Ÿï¼Œå»¶è¯¯â€ã€‚" },
                { id: 9, q: "I didn't really want to go but he <u>insisted</u>.", options: ["A. åšæŒ", "B. åŒæ„", "C. ç¦»å¼€", "D. éšç’"], ans: "A", exp: "<span class='analysis-label'>ã€å¥æ„ã€‘</span> æˆ‘çœŸçš„ä¸æƒ³å»ï¼Œä½†ä»–åšæŒï¼ˆè¦æˆ‘å»ï¼‰ã€‚<br><span class='analysis-label'>ã€è§£æã€‘</span> insist æ„ä¸ºâ€œåšæŒâ€ã€‚" },
                { id: 10, q: "I have no <u>sympathy</u> for Jane, it's all her fault.", options: ["A. å…´è¶£", "B. åŒæ¶", "C. é¼“åŠ±", "D. åŒæƒ…"], ans: "D", exp: "<span class='analysis-label'>ã€å¥æ„ã€‘</span> æˆ‘ä¸åŒæƒ…ç®€ï¼Œé‚£å…¨æ˜¯å¥¹çš„é”™ã€‚<br><span class='analysis-label'>ã€è§£æã€‘</span> sympathy æ„ä¸ºâ€œåŒæƒ…â€ã€‚" },
                { id: 11, q: "It's a pleasure to <u>team up with</u> such excellent students as you.", options: ["A. å­¦ä¹ ", "B. è¯„ä»·", "C. ä¿æŠ¤", "D. åˆä½œ"], ans: "D", exp: "<span class='analysis-label'>ã€å¥æ„ã€‘</span> ä¸åƒä½ è¿™æ ·ä¼˜ç§€çš„å­¦ç”Ÿåˆä½œå¾ˆé«˜å…´ã€‚<br><span class='analysis-label'>ã€è§£æã€‘</span> team up with æ„ä¸ºâ€œä¸...åˆä½œ/ç»„é˜Ÿâ€ã€‚" },
                { id: 12, q: "Free tickets for the New Year concert are <u>available</u> from the school.", options: ["A. å¯æ”¶è—çš„", "B. å¯å›æ”¶çš„", "C. å¯è·å¾—çš„", "D. å¯å¤åˆ¶çš„"], ans: "C", exp: "<span class='analysis-label'>ã€å¥æ„ã€‘</span> æ–°å¹´éŸ³ä¹ä¼šçš„å…è´¹é—¨ç¥¨å¯ä»¥ä»å­¦æ ¡è·å¾—ã€‚<br><span class='analysis-label'>ã€è§£æã€‘</span> available æ„ä¸ºâ€œå¯è·å¾—çš„â€ã€‚" },
                { id: 13, q: "Mary is the editor <u>in charge of</u> the art and music section.", options: ["A. æ•™æˆ", "B. è´Ÿè´£", "C. è®¿é—®", "D. æŒ‡æ§"], ans: "B", exp: "<span class='analysis-label'>ã€å¥æ„ã€‘</span> ç›ä¸½æ˜¯è´Ÿè´£è‰ºæœ¯å’ŒéŸ³ä¹ç‰ˆå—çš„ç¼–è¾‘ã€‚<br><span class='analysis-label'>ã€è§£æã€‘</span> in charge of æ„ä¸ºâ€œè´Ÿè´£ï¼Œä¸»ç®¡â€ã€‚" },
                { id: 14, q: "\"Right\" and \"wrong\" are just <u>comparative</u> terms.", options: ["A. è¤’ä¹‰çš„", "B. ç›¸å¯¹çš„", "C. å®¢è§‚çš„", "D. ä¸“å±çš„"], ans: "B", exp: "<span class='analysis-label'>ã€å¥æ„ã€‘</span> â€œå¯¹â€ä¸â€œé”™â€åªæ˜¯ç›¸å¯¹çš„æ¦‚å¿µã€‚<br><span class='analysis-label'>ã€è§£æã€‘</span> comparative æ„ä¸ºâ€œç›¸å¯¹çš„ï¼Œæ¯”è¾ƒçš„â€ã€‚" },
                { id: 15, q: "When <u>exactly</u> are they supposed to arrive?", options: ["A. åŸºæœ¬åœ°", "B. åˆ†æ•£åœ°", "C. ç¡®åˆ‡åœ°", "D. ç¨³å¦¥åœ°"], ans: "C", exp: "<span class='analysis-label'>ã€å¥æ„ã€‘</span> ä»–ä»¬ç¡®åˆ‡ä»€ä¹ˆæ—¶å€™åº”è¯¥åˆ°è¾¾ï¼Ÿ<br><span class='analysis-label'>ã€è§£æã€‘</span> exactly æ„ä¸ºâ€œç¡®åˆ‡åœ°â€ã€‚" }
            ]
        },
        {
            id: 'part3',
            title: "III. å®Œå½¢å¡«ç©º (åˆ†å±)",
            type: 'split_choice',
            paragraphs: [
                { en: "One day, Lucy took a late-night flight to Beijing. The flight was unexpectedly full. As the last <b>[16]</b> to board the plane, Lucy had to leave her bag in an area away from her.", cn: "ä¸€å¤©ï¼Œéœ²è¥¿ä¹˜åæ·±å¤œèˆªç­é£å¾€åŒ—äº¬ã€‚èˆªç­å‡ºä¹æ„æ–™åœ°æ»¡äº†ã€‚ä½œä¸ºæœ€åä¸€ä¸ªç™»æœºçš„<b>[16]ä¹˜å®¢</b>ï¼Œéœ²è¥¿ä¸å¾—ä¸æŠŠåŒ…æ”¾åœ¨ç¦»å¥¹å¾ˆè¿œçš„åœ°æ–¹ã€‚" },
                { en: "After two hours, the plane <b>[17]</b>. Lucy rushed out of the airport and headed off to the hotel to have a good <b>[18]</b>. When Lucy <b>[19]</b> the hotel room, she immediately threw herself onto the bed.", cn: "ä¸¤å°æ—¶åï¼Œé£æœº<b>[17]é™è½</b>äº†ã€‚éœ²è¥¿å†²å‡ºæœºåœºï¼Œç›´å¥”é…’åº—æƒ³å¥½å¥½<b>[18]ç¡ä¸€è§‰</b>ã€‚å½“éœ²è¥¿<b>[19]è¿›å…¥</b>é…’åº—æˆ¿é—´æ—¶ï¼Œå¥¹ç«‹åˆ»æ‰‘å€’åœ¨åºŠä¸Šã€‚" },
                { en: "Suddenly, she remembered that she still had some urgent work to do. She got up and looked for her <b>[20]</b> where she had put her laptop. But she couldn't find it. \"Oh, my goodness!\" Lucy <b>[21]</b>. \"I left the bag on the plane.\"", cn: "çªç„¶ï¼Œå¥¹æƒ³èµ·è¿˜æœ‰äº›ç´§æ€¥å·¥ä½œè¦åšã€‚å¥¹èµ·èº«å¯»æ‰¾æ”¾ç¬”è®°æœ¬ç”µè„‘çš„<b>[20]åŒ…</b>ã€‚ä½†å¥¹æ‰¾ä¸åˆ°ã€‚\"å“¦ï¼Œå¤©å“ªï¼\"éœ²è¥¿<b>[21]å¤§å«é“</b>ã€‚\"æˆ‘æŠŠåŒ…è½åœ¨é£æœºä¸Šäº†ã€‚\"" },
                { en: "She picked up her phone and searched for the <b>[22]</b> of the airline company. Lucy wondered whether it was <b>[23]</b> to get help so late at night. <b>[24]</b>, she found a hotline number and made the call.", cn: "å¥¹æ‹¿èµ·æ‰‹æœºï¼Œæœç´¢èˆªç©ºå…¬å¸çš„<b>[22]å·ç </b>ã€‚éœ²è¥¿ä¸çŸ¥é“è¿™ä¹ˆæ™šäº†æ˜¯å¦<b>[23]å¯èƒ½</b>å¾—åˆ°å¸®åŠ©ã€‚<b>[24]å¹¸è¿åœ°</b>ï¼Œå¥¹æ‰¾åˆ°äº†ä¸€ä¸ªçƒ­çº¿å·ç å¹¶æ‹¨æ‰“äº†è¿‡å»ã€‚" },
                { en: "She was quite <b>[25]</b> to get through. After <b>[26]</b> what had happened, she was asked to wait for a reply. Keeping her fingers crossed, Lucy walked up and down the room <b>[27]</b>.", cn: "ç”µè¯æ¥é€šäº†ï¼Œå¥¹æ„Ÿåˆ°éå¸¸<b>[25]é«˜å…´</b>ã€‚åœ¨<b>[26]è§£é‡Š</b>äº†å‘ç”Ÿçš„äº‹æƒ…åï¼Œå¥¹è¢«è¦æ±‚ç­‰å¾…å›å¤ã€‚éœ²è¥¿ç¥ˆç¥·ç€ï¼Œ<b>[27]ç„¦è™‘åœ°</b>åœ¨æˆ¿é—´é‡Œæ¥å›è¸±æ­¥ã€‚" },
                { en: "An hour later, Lucy received a <b>[28]</b> from the airport. It turned out that her bag had been <b>[29]</b> to the lost-and-found department of the airport. She hurried back to the airport at once and <b>[30]</b> her belongings.", cn: "ä¸€å°æ—¶åï¼Œéœ²è¥¿æ¥åˆ°äº†æœºåœºçš„<b>[28]ç”µè¯</b>ã€‚åŸæ¥å¥¹çš„åŒ…è¢«<b>[29]é€</b>åˆ°äº†æœºåœºå¤±ç‰©æ‹›é¢†å¤„ã€‚å¥¹ç«‹åˆ»èµ¶å›æœºåœºï¼Œ<b>[30]å–å›</b>äº†è‡ªå·±çš„ç‰©å“ã€‚" }
            ],
            questions: [
                { id: 16, options: ["A. pilot", "B. guard", "C. driver", "D. passenger"], ans: "D", exp: "<span class='analysis-label'>ã€å¥æ„ã€‘</span> ä½œä¸ºæœ€åä¸€ä¸ªç™»æœºçš„ä¹˜å®¢...<br><span class='analysis-label'>ã€è§£æã€‘</span> æ ¹æ®è¯­å¢ƒï¼Œå¥¹æ˜¯ä¹˜å®¢(passenger)ã€‚" },
                { id: 17, options: ["A. flew", "B. rolled", "C. landed", "D. passed"], ans: "C", exp: "<span class='analysis-label'>ã€å¥æ„ã€‘</span> ä¸¤å°æ—¶åï¼Œé£æœºé™è½äº†ã€‚<br><span class='analysis-label'>ã€è§£æã€‘</span> èˆªç­ç»“æŸï¼Œé£æœºé™è½ç”¨ landedã€‚" },
                { id: 18, options: ["A. sleep", "B. meal", "C. talk", "D. bath"], ans: "A", exp: "<span class='analysis-label'>ã€å¥æ„ã€‘</span> å»é…’åº—å¥½å¥½ç¡ä¸€è§‰ã€‚<br><span class='analysis-label'>ã€è§£æã€‘</span> åæ–‡æåˆ°æ‰‘å€’åœ¨åºŠä¸Šï¼Œæ•…é€‰ sleepã€‚" },
                { id: 19, options: ["A. got into", "B. broke into", "C. looked into", "D. turned into"], ans: "A", exp: "<span class='analysis-label'>ã€å¥æ„ã€‘</span> å½“éœ²è¥¿è¿›å…¥æˆ¿é—´æ—¶...<br><span class='analysis-label'>ã€è§£æã€‘</span> è¿›å…¥æˆ¿é—´ç”¨ got intoã€‚" },
                { id: 20, options: ["A. key", "B. bag", "C. phone", "D. passport"], ans: "B", exp: "<span class='analysis-label'>ã€å¥æ„ã€‘</span> å¥¹å¯»æ‰¾æ”¾ç¬”è®°æœ¬ç”µè„‘çš„åŒ…ã€‚<br><span class='analysis-label'>ã€è§£æã€‘</span> ç”µè„‘é€šå¸¸æ”¾åœ¨åŒ…(bag)é‡Œã€‚" },
                { id: 21, options: ["A. cheered", "B. shouted", "C. demanded", "D. repeated"], ans: "B", exp: "<span class='analysis-label'>ã€å¥æ„ã€‘</span> â€œå“¦å¤©å“ªï¼â€éœ²è¥¿å¤§å«é“ã€‚<br><span class='analysis-label'>ã€è§£æã€‘</span> å‘ç°ä¸œè¥¿ä¸¢äº†ï¼Œæƒ…ç»ªæ¿€åŠ¨å¤§å«(shouted)ã€‚" },
                { id: 22, options: ["A. map", "B. name", "C. number", "D. picture"], ans: "C", exp: "<span class='analysis-label'>ã€å¥æ„ã€‘</span> æœç´¢èˆªç©ºå…¬å¸çš„å·ç ã€‚<br><span class='analysis-label'>ã€è§£æã€‘</span> æ‰¾å®¢æœè”ç³»æ–¹å¼å³æ‰¾ç”µè¯å·ç (number)ã€‚" },
                { id: 23, options: ["A. safe", "B. helpful", "C. necessary", "D. possible"], ans: "D", exp: "<span class='analysis-label'>ã€å¥æ„ã€‘</span> ä¸çŸ¥é“æ˜¯å¦å¯èƒ½å¾—åˆ°å¸®åŠ©ã€‚<br><span class='analysis-label'>ã€è§£æã€‘</span> possible æ„ä¸ºå¯èƒ½çš„ã€‚" },
                { id: 24, options: ["A. Curiously", "B. Luckily", "C. Strangely", "D. Confidently"], ans: "B", exp: "<span class='analysis-label'>ã€å¥æ„ã€‘</span> å¹¸è¿åœ°ï¼Œå¥¹æ‰¾åˆ°äº†çƒ­çº¿ã€‚<br><span class='analysis-label'>ã€è§£æã€‘</span> äº‹æƒ…æœ‰äº†è½¬æœºï¼Œè¡¨ç¤ºå¹¸è¿ç”¨ Luckilyã€‚" },
                { id: 25, options: ["A. shy", "B. angry", "C. delighted", "D. disappointed"], ans: "C", exp: "<span class='analysis-label'>ã€å¥æ„ã€‘</span> ç”µè¯æ¥é€šå¥¹å¾ˆé«˜å…´ã€‚<br><span class='analysis-label'>ã€è§£æã€‘</span> é—®é¢˜æœ‰æœ›è§£å†³ï¼Œå¿ƒæƒ…æ˜¯é«˜å…´çš„(delighted)ã€‚" },
                { id: 26, options: ["A. watching", "B. explaining", "C. checking", "D. questioning"], ans: "B", exp: "<span class='analysis-label'>ã€å¥æ„ã€‘</span> åœ¨è§£é‡Šäº†å‘ç”Ÿçš„äº‹æƒ…å...<br><span class='analysis-label'>ã€è§£æã€‘</span> å‘å®¢æœè¯´æ˜æƒ…å†µç”¨ explainingã€‚" },
                { id: 27, options: ["A. quietly", "B. freely", "C. worriedly", "D. happily"], ans: "C", exp: "<span class='analysis-label'>ã€å¥æ„ã€‘</span> éœ²è¥¿ç„¦è™‘åœ°åœ¨æˆ¿é—´è¸±æ­¥ã€‚<br><span class='analysis-label'>ã€è§£æã€‘</span> ç­‰å¾…ç»“æœæ—¶å¿ƒæƒ…å¿å¿‘ï¼Œç”¨ worriedlyã€‚" },
                { id: 28, options: ["A. call", "B. gift", "C. letter", "D. ticket"], ans: "A", exp: "<span class='analysis-label'>ã€å¥æ„ã€‘</span> æ¥åˆ°äº†æœºåœºçš„ç”µè¯ã€‚<br><span class='analysis-label'>ã€è§£æã€‘</span> receive a call æ¥åˆ°ç”µè¯ã€‚" },
                { id: 29, options: ["A. sent", "B. sold", "C. shown", "D. exported"], ans: "A", exp: "<span class='analysis-label'>ã€å¥æ„ã€‘</span> åŒ…è¢«é€åˆ°äº†å¤±ç‰©æ‹›é¢†å¤„ã€‚<br><span class='analysis-label'>ã€è§£æã€‘</span> be sent to è¢«é€åˆ°ã€‚" },
                { id: 30, options: ["A. hid", "B. changed", "C. returned", "D. collected"], ans: "D", exp: "<span class='analysis-label'>ã€å¥æ„ã€‘</span> å–å›äº†è‡ªå·±çš„ç‰©å“ã€‚<br><span class='analysis-label'>ã€è§£æã€‘</span> collect æ„ä¸ºé¢†å–ã€å–å›ã€‚" }
            ]
        },
        {
            id: 'part5',
            title: "V. è¯­æ³•å¡«ç©º (åˆ†å±+è¾“å…¥)",
            type: 'split_input',
            desc: "é˜…è¯»ä¸‹é¢çŸ­æ–‡ï¼Œåœ¨ç©ºæ ¼å¤„å¡«å…¥ä¸€ä¸ªé€‚å½“çš„è¯æˆ–ç”¨æ‹¬å·ä¸­è¯è¯­çš„æ­£ç¡®å½¢å¼å¡«ç©ºã€‚<b>è¯·ç›´æ¥ç‚¹å‡»æ¨ªçº¿è¾“å…¥ï¼Œå¹¶ç‚¹å‡»å³ä¾§ã€ç¡®è®¤ã€‘æŒ‰é’®ã€‚</b>",
            paragraphs: [
                { en: "Clare is a little girl with great curiosity. She can't decide what she wants to be when she grows up. One day, Clare asked her mom [46] ______ advice. Mom thought carefully, and then decided [47] ______ (take) her on a job adventure.", cn: "ã€ç¿»è¯‘ã€‘å…‹è±å°”æ˜¯ä¸ªå¥½å¥‡å¿ƒå¾ˆå¼ºçš„å°å¥³å­©ã€‚å¥¹è¿˜æ²¡å†³å®šé•¿å¤§åæƒ³åšä»€ä¹ˆã€‚æœ‰ä¸€å¤©ï¼Œå…‹è±å°”å‘å¦ˆå¦ˆå¯»æ±‚[46](for)å»ºè®®ã€‚å¦ˆå¦ˆä»”ç»†æ€è€ƒåï¼Œå†³å®š[47](to take)å¸¦å¥¹å»ä½“éªŒä¸€æ¬¡èŒä¸šå†’é™©ã€‚" },
                { en: "The next day, Clare and Mom set off. Their first stop was a hospital. There, Clare learned that doctors cure illnesses and help [48] ______ (patient) get well. She knew [49] ______ important doctors are.", cn: "ã€ç¿»è¯‘ã€‘ç¬¬äºŒå¤©ï¼Œå…‹è±å°”å’Œå¦ˆå¦ˆå‡ºå‘äº†ã€‚ç¬¬ä¸€ç«™æ˜¯åŒ»é™¢ã€‚åœ¨é‚£é‡Œï¼Œå…‹è±å°”äº†è§£åˆ°åŒ»ç”Ÿæ²»æ„ˆç–¾ç—…å¹¶å¸®åŠ©[48](patients)ç—…äººåº·å¤ã€‚å¥¹çŸ¥é“äº†åŒ»ç”Ÿæ˜¯[49](how)å¤šä¹ˆé‡è¦ã€‚" },
                { en: "Their adventure continued. At a school, they met a kind young teacher [50] ______ showed them around. Teachers help students learn new things in schools and open up [51] ______ whole new world of possibilities for them.", cn: "ã€ç¿»è¯‘ã€‘å¥¹ä»¬çš„å†’é™©ç»§ç»­ç€ã€‚åœ¨ä¸€æ‰€å­¦æ ¡ï¼Œå¥¹ä»¬é‡åˆ°äº†ä¸€ä½å–„è‰¯çš„å¹´è½»è€å¸ˆï¼Œå¥¹[50](who)å¸¦å¥¹ä»¬å‚è§‚ã€‚è€å¸ˆå¸®åŠ©å­¦ç”Ÿåœ¨å­¦æ ¡å­¦ä¹ æ–°äº‹ç‰©ï¼Œå¹¶ä¸ºä»–ä»¬å¼€å¯[51](a)ä¸€ä¸ªå……æ»¡å¯èƒ½æ€§çš„å…¨æ–°ä¸–ç•Œã€‚" },
                { en: "Finally, they stopped by a construction site. A [52] ______ (friend) engineer gave them hard hats and showed them the blueprint for a new park. Clare understood that engineers design things and build places, [53] ______ (make) people's life better.", cn: "ã€ç¿»è¯‘ã€‘æœ€åï¼Œå¥¹ä»¬åœ¨å»ºç­‘å·¥åœ°åœäº†ä¸‹æ¥ã€‚ä¸€ä½[52](friendly)å‹å¥½çš„å·¥ç¨‹å¸ˆç»™äº†å¥¹ä»¬å®‰å…¨å¸½ï¼Œå¹¶ç»™å¥¹ä»¬çœ‹äº†æ–°å…¬å›­çš„è“å›¾ã€‚å…‹è±å°”æ˜ç™½äº†å·¥ç¨‹å¸ˆè®¾è®¡ä¸œè¥¿ã€å»ºé€ åœºæ‰€ï¼Œ[53](making)è®©äººä»¬çš„ç”Ÿæ´»æ›´ç¾å¥½ã€‚" },
                { en: "When the adventure [54] ______ (end), Clare learned a lot about jobs. Although she has yet to decide what to do in the future, she has realized that various jobs, each like a unique puzzle piece, fit [55] ______ (perfect) to make the world a better place to live.", cn: "ã€ç¿»è¯‘ã€‘å½“å†’é™©[54](ended)ç»“æŸæ—¶ï¼Œå…‹è±å°”å­¦åˆ°äº†å¾ˆå¤šå…³äºå·¥ä½œçš„çŸ¥è¯†ã€‚è™½ç„¶å¥¹è¿˜æ²¡å†³å®šå°†æ¥åšä»€ä¹ˆï¼Œä½†å¥¹æ„è¯†åˆ°å„ç§å„æ ·çš„å·¥ä½œï¼Œæ¯ä¸€ä¸ªå°±åƒç‹¬ç‰¹çš„æ‹¼å›¾ç¢ç‰‡ï¼Œ[55](perfectly)å®Œç¾åœ°æ‹¼åˆåœ¨ä¸€èµ·ï¼Œè®©ä¸–ç•Œå˜å¾—æ›´å®œå±…ã€‚" }
            ],
            questions: [
                { id: 46, ans: "for", exp: "<span class='analysis-label'>ã€è§£æã€‘</span> ask sb for advice å›ºå®šæ­é…ï¼Œæ„ä¸ºâ€œå‘æŸäººå¯»æ±‚å»ºè®®â€ã€‚" },
                { id: 47, ans: "to take", exp: "<span class='analysis-label'>ã€è§£æã€‘</span> decide to do sth å›ºå®šæ­é…ï¼Œæ„ä¸ºâ€œå†³å®šåšæŸäº‹â€ã€‚" },
                { id: 48, ans: "patients", exp: "<span class='analysis-label'>ã€è§£æã€‘</span> patientä½œhelpçš„å®¾è¯­ï¼Œæ³›æŒ‡â€œç—…äººâ€ï¼Œéœ€ç”¨å¤æ•° patientsã€‚" },
                { id: 49, ans: "how", exp: "<span class='analysis-label'>ã€è§£æã€‘</span> å¼•å¯¼æ„Ÿå¹å¥å®¾è¯­ä»å¥ï¼Œä¿®é¥°å½¢å®¹è¯ importantï¼Œç”¨ howã€‚" },
                { id: 50, ans: "who", exp: "<span class='analysis-label'>ã€è§£æã€‘</span> å®šè¯­ä»å¥ï¼Œå…ˆè¡Œè¯ teacher æŒ‡äººï¼Œä¸”åœ¨ä»å¥ä¸­ä½œä¸»è¯­ï¼Œç”¨ who å¼•å¯¼ã€‚" },
                { id: 51, ans: "a", exp: "<span class='analysis-label'>ã€è§£æã€‘</span> æ³›æŒ‡â€œä¸€ä¸ªâ€å…¨æ–°çš„ä¸–ç•Œï¼Œwhole ä»¥è¾…éŸ³éŸ³ç´ å¼€å¤´ï¼Œç”¨ä¸å®šå† è¯ aã€‚" },
                { id: 52, ans: "friendly", exp: "<span class='analysis-label'>ã€è§£æã€‘</span> ä¿®é¥°åè¯ engineerï¼Œåº”ç”¨å½¢å®¹è¯ friendly (å‹å¥½çš„)ã€‚" },
                { id: 53, ans: "making", exp: "<span class='analysis-label'>ã€è§£æã€‘</span> åŠ¨è¯ make ä¸é€»è¾‘ä¸»è¯­ engineers ä¹‹é—´æ˜¯ä¸»åŠ¨å…³ç³»ï¼Œä½œç»“æœ/ä¼´éšçŠ¶è¯­ï¼Œç”¨ç°åœ¨åˆ†è¯ makingã€‚" },
                { id: 54, ans: "ended", exp: "<span class='analysis-label'>ã€è§£æã€‘</span> å™è¿°è¿‡å»å‘ç”Ÿçš„äº‹æƒ…ï¼Œç”¨ä¸€èˆ¬è¿‡å»æ—¶ endedã€‚" },
                { id: 55, ans: "perfectly", exp: "<span class='analysis-label'>ã€è§£æã€‘</span> ä¿®é¥°åŠ¨è¯ fitï¼Œåº”ç”¨å‰¯è¯ perfectly (å®Œç¾åœ°)ã€‚" }
            ]
        },
        {
            id: 'part6',
            title: "VI. å®Œæˆå¥å­ (å¡«ç©º)",
            type: 'input_sentence',
            desc: "æ ¹æ®æ‰€ç»™æ±‰è¯­æç¤ºï¼Œåœ¨æ¨ªçº¿ä¸Šå¡«å†™æ­£ç¡®çš„è‹±è¯­è¡¨è¾¾ã€‚<b>å¡«å†™åç‚¹å‡»å³ä¾§ã€ç¡®è®¤ã€‘æŒ‰é’®ã€‚</b>",
            questions: [
                { id: 56, q: "56. (æˆ‘ä»¬ä»€ä¹ˆæ—¶å€™å¼€ä¼š) ______ is still under discussion.", ans: "When we will have the meeting", exp: "<span class='analysis-label'>ã€å¥æ„ã€‘</span> æˆ‘ä»¬ä»€ä¹ˆæ—¶å€™å¼€ä¼šè¿˜åœ¨è®¨è®ºä¸­ã€‚<br><span class='analysis-label'>ã€è§£æã€‘</span> ä¸»è¯­ä»å¥ + é™ˆè¿°è¯­åº + ä¸€èˆ¬å°†æ¥æ—¶ã€‚" },
                { id: 57, q: "57. It is wise of you ______ (ä¿æŠ¤ä¸ªäººä¿¡æ¯).", ans: "to protect personal information", exp: "<span class='analysis-label'>ã€å¥æ„ã€‘</span> ä¿æŠ¤ä¸ªäººä¿¡æ¯æ˜¯æ˜æ™ºçš„ã€‚<br><span class='analysis-label'>ã€è§£æã€‘</span> It is wise of sb to do sthï¼Œä¸å®šå¼ä½œçœŸä¸»è¯­ã€‚" },
                { id: 58, q: "58. This is the only house ______ (éœ€è¦ç»´ä¿®çš„).", ans: "that needs repairing", exp: "<span class='analysis-label'>ã€å¥æ„ã€‘</span> è¿™æ˜¯å”¯ä¸€éœ€è¦ç»´ä¿®çš„æˆ¿å­ã€‚<br><span class='analysis-label'>ã€è§£æã€‘</span> å…ˆè¡Œè¯è¢« only ä¿®é¥°ï¼Œå®šè¯­ä»å¥å…³ç³»è¯ç”¨ thatï¼›need doing (éœ€è¦è¢«...)ã€‚" },
                { id: 59, q: "59. The box is ______ (å¤ªé‡äº†æä¸åŠ¨).", ans: "too heavy to carry", exp: "<span class='analysis-label'>ã€å¥æ„ã€‘</span> è¿™ä¸ªç®±å­å¤ªé‡äº†æä¸åŠ¨ã€‚<br><span class='analysis-label'>ã€è§£æã€‘</span> too ... to ... ç»“æ„ï¼Œæ„ä¸ºâ€œå¤ª...ä»¥è‡³äºä¸èƒ½...â€ã€‚" },
                { id: 60, q: "60. So far, ______ (æˆ‘ä»¬è¿˜æ²¡å®Œæˆä»»åŠ¡).", ans: "we haven't finished the task yet", exp: "<span class='analysis-label'>ã€å¥æ„ã€‘</span> åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬è¿˜æ²¡å®Œæˆä»»åŠ¡ã€‚<br><span class='analysis-label'>ã€è§£æã€‘</span> So far æ˜¯ç°åœ¨å®Œæˆæ—¶çš„æ ‡å¿—è¯ã€‚" }
            ]
        },
        {
            id: 'part7',
            title: "VII. åº”ç”¨å†™ä½œ",
            type: 'writing',
            desc: "è¯·åœ¨ä¸‹æ–¹æ–‡æœ¬æ¡†ä¸­è¾“å…¥ä½œæ–‡ï¼Œç‚¹å‡»æäº¤åæ˜¾ç¤ºå‚è€ƒèŒƒæ–‡ã€‚",
            questions: [
                { id: 61, q: "61. è¯·ç»™å¤–æ•™Mr. Smithå†™é‚®ä»¶ï¼Œè¯·ä»–ç»™ä½ ä¸€äº›æé«˜è‹±è¯­å£è¯­çš„å»ºè®®ã€‚ï¼ˆæ­£æ–‡çº¦40è¯ï¼‰", ans: "Dear Mr. Smith,\nI'm Li Hua, a student from your class. I'm writing to ask for your advice on improving my spoken English. I really want to make progress and hope you can give me some useful suggestions. Thank you very much.\nYours sincerely,\nLi Hua", exp: "<span class='analysis-label'>ã€å‚è€ƒèŒƒæ–‡ã€‘</span> (è§ä¸Šæ–‡)<br><span class='analysis-label'>ã€å†™ä½œè¦ç‚¹ã€‘</span><br>1. è‡ªæˆ‘ä»‹ç» (student from your class);<br>2. å†™ä½œç›®çš„ (ask for advice on spoken English);<br>3. è¡¨è¾¾æœŸæœ›å’Œæ„Ÿè°¢ã€‚" }
            ]
        }
    ];

    let userResponses = {}; 
    let currentSectionIndex = 0;
    let isRetryMode = false;
    let correctIds = new Set(); // è®°å½•åšå¯¹çš„é¢˜ç›®ID

    function login() {
        const cls = document.getElementById('u-class').value;
        const name = document.getElementById('u-name').value;
        if (!cls || !name) return alert("è¯·è¾“å…¥ç­çº§å’Œå§“å");
        
        document.getElementById('disp-name').innerText = name;
        document.getElementById('disp-id').innerText = cls + "ç­";
        document.getElementById('login-overlay').style.display = 'none';
        document.getElementById('sidebar').style.display = 'flex';
        document.getElementById('main-area').style.display = 'block';
        
        initMenu();
        showSection(0);
    }

    function initMenu() {
        const container = document.getElementById('menu-container');
        container.innerHTML = '';
        examData.forEach((part, index) => {
            const item = document.createElement('div');
            item.className = 'menu-item';
            item.innerHTML = part.title;
            item.onclick = () => showSection(index);
            container.appendChild(item);
        });
    }

    function showSection(index) {
        currentSectionIndex = index;
        const container = document.getElementById('content-container');
        container.innerHTML = ''; 
        
        document.querySelectorAll('.menu-item').forEach((el, i) => {
            el.classList.toggle('active', i === index);
        });

        const data = examData[index];
        
        const title = document.createElement('h2');
        title.innerHTML = data.title + (isRetryMode ? " <span style='color:red;font-size:0.6em'>(é”™é¢˜é‡ç»ƒæ¨¡å¼)</span>" : "");
        container.appendChild(title);

        if(data.desc) {
            const desc = document.createElement('p');
            desc.innerHTML = data.desc;
            desc.style.color = '#666';
            container.appendChild(desc);
        }

        if (data.type === 'choice') renderChoice(data, container);
        else if (data.type === 'split_choice') renderSplitChoice(data, container);
        else if (data.type === 'split_input') renderSplitInput(data, container);
        else if (data.type === 'input_sentence') renderInputSentence(data, container);
        else if (data.type === 'writing') renderWriting(data, container);
    }

    // è¾…åŠ©ï¼šæ£€æŸ¥æ˜¯å¦åº”è¯¥æ˜¾ç¤ºè¯¥é¢˜ (é”™é¢˜æ¨¡å¼é€»è¾‘)
    function shouldRenderQuestion(qid) {
        if (!isRetryMode) return true;
        return !correctIds.has(qid); // å¦‚æœåœ¨é”™é¢˜æ¨¡å¼ä¸‹ï¼Œåªæ˜¾ç¤ºæœªåšå¯¹çš„
    }

    // 3) ç¿»è¯‘æŠ˜å æ§åˆ¶å‡½æ•°
    window.toggleTrans = function(id) {
        const el = document.getElementById(id);
        const btn = document.getElementById('btn-' + id);
        if (el.style.display === 'block') {
            el.style.display = 'none';
            btn.innerHTML = 'ç‚¹å‡»æŸ¥çœ‹ç¿»è¯‘';
        } else {
            el.style.display = 'block';
            btn.innerHTML = 'æ”¶èµ·ç¿»è¯‘';
        }
    };

    function renderChoice(data, container) {
        data.questions.forEach(q => {
            if (!shouldRenderQuestion(q.id)) return;

            const card = document.createElement('div');
            card.className = 'question-card';
            
            let html = `<div class="q-title">${q.id}. ${q.q}</div>`;
            html += `<div class="options-group">`;
            q.options.forEach(opt => {
                html += `<button class="option-btn" onclick="checkChoice(this, ${q.id}, '${opt}', '${q.ans}')">${opt}</button>`;
            });
            html += `</div>`;
            html += `<div class="analysis-box" id="exp-${q.id}">${q.exp}</div>`;
            
            card.innerHTML = html;
            container.appendChild(card);
            
            if (userResponses[q.id]) restoreChoiceState(card, q.id, q.ans);
        });
    }

    function renderSplitChoice(data, container) {
        const wrap = document.createElement('div');
        wrap.className = 'split-layout';
        
        const left = document.createElement('div');
        left.className = 'passage-panel';
        data.paragraphs.forEach((p, idx) => {
            const transId = `p-trans-${idx}`;
            left.innerHTML += `
                <p>${p.en}</p>
                <span id="btn-${transId}" class="trans-toggle-btn" onclick="toggleTrans('${transId}')">ç‚¹å‡»æŸ¥çœ‹ç¿»è¯‘</span>
                <div id="${transId}" class="para-trans">${p.cn}</div>
                <hr style="border:0; border-top:1px dashed #eee; margin:15px 0;">
            `;
        });
        
        const right = document.createElement('div');
        right.className = 'questions-panel';
        renderChoice({questions: data.questions}, right);
        
        wrap.appendChild(left);
        wrap.appendChild(right);
        container.appendChild(wrap);
    }

    function renderSplitInput(data, container) {
        const wrap = document.createElement('div');
        wrap.className = 'split-layout';
        
        const left = document.createElement('div');
        left.className = 'passage-panel';
        
        data.paragraphs.forEach((p, idx) => {
            let processedEn = p.en.replace(/\[(\d+)\]\s*______/g, (match, id) => {
                // å¦‚æœé”™é¢˜æ¨¡å¼ä¸”è¯¥é¢˜å·²å¯¹ï¼Œæ˜¾ç¤ºæ–‡æœ¬è€Œéè¾“å…¥æ¡†
                if (isRetryMode && correctIds.has(parseInt(id))) {
                    const ans = data.questions.find(q => q.id == id).ans;
                    return `[${id}] <strong style="color:green; border-bottom:1px solid green;">${ans}</strong>`;
                }
                return `[${id}] <input type="text" class="inline-input" id="input-${id}" autocomplete="off">`;
            });
            
            const transId = `p-gram-trans-${idx}`;
            left.innerHTML += `
                <p>${processedEn}</p>
                <span id="btn-${transId}" class="trans-toggle-btn" onclick="toggleTrans('${transId}')">ç‚¹å‡»æŸ¥çœ‹ç¿»è¯‘</span>
                <div id="${transId}" class="para-trans">${p.cn}</div>
                <hr style="border:0; border-top:1px dashed #eee; margin:15px 0;">
            `;
        });

        const right = document.createElement('div');
        right.className = 'questions-panel';
        
        let hasQuestions = false;
        data.questions.forEach(q => {
            if (!shouldRenderQuestion(q.id)) return;
            hasQuestions = true;

            const card = document.createElement('div');
            card.className = 'question-card';
            card.innerHTML = `
                <div style="display:flex; justify-content:space-between; align-items:center;">
                    <strong>ç¬¬ ${q.id} é¢˜</strong>
                    <button class="check-btn" onclick="checkInput(${q.id}, '${q.ans}')">ç¡®è®¤ç­”æ¡ˆ</button>
                </div>
                <div class="analysis-box" id="exp-${q.id}">
                    <strong>æ­£ç¡®ç­”æ¡ˆï¼š</strong> ${q.ans}<br>
                    ${q.exp}
                </div>
            `;
            right.appendChild(card);
        });

        if (!hasQuestions && isRetryMode) {
            right.innerHTML = "<div style='padding:20px; color:#999;'>æœ¬éƒ¨åˆ†å·²å…¨éƒ¨å®Œæˆï¼</div>";
        }

        wrap.appendChild(left);
        wrap.appendChild(right);
        container.appendChild(wrap);

        setTimeout(() => restoreInputState(data.questions), 100);
    }

    function renderInputSentence(data, container) {
        let hasQuestions = false;
        data.questions.forEach(q => {
            if (!shouldRenderQuestion(q.id)) return;
            hasQuestions = true;

            const card = document.createElement('div');
            card.className = 'question-card';
            // 4) å…è®¸ç›´æ¥åœ¨æ¨ªçº¿å¤„å¡«å†™ -> æ›¿æ¢ ______ ä¸ºè¾“å…¥æ¡†
            const qHtml = q.q.replace('______', `<input type="text" class="inline-input" id="input-${q.id}" style="width:250px" autocomplete="off">`);
            
            card.innerHTML = `
                <div class="q-title">${qHtml}</div>
                <div style="margin-top:15px;">
                    <button class="check-btn" onclick="checkInput(${q.id}, '${q.ans}')">ç¡®è®¤ç­”æ¡ˆ</button>
                </div>
                <div class="analysis-box" id="exp-${q.id}">
                    <strong>å‚è€ƒç­”æ¡ˆï¼š</strong> ${q.ans}<br>
                    ${q.exp}
                </div>
            `;
            container.appendChild(card);
        });
        if (!hasQuestions && isRetryMode) {
            container.innerHTML += "<div style='padding:20px; color:#999;'>æœ¬éƒ¨åˆ†å·²å…¨éƒ¨å®Œæˆï¼</div>";
        }
        setTimeout(() => restoreInputState(data.questions), 100);
    }

    function renderWriting(data, container) {
        data.questions.forEach(q => {
            // å†™ä½œé¢˜é€šå¸¸ä¸å‚ä¸â€œå¯¹é”™â€è‡ªåŠ¨åˆ¤æ–­ï¼Œä½†åœ¨é”™é¢˜æ¨¡å¼ä¸‹æˆ‘ä»¬å¯ä»¥å§‹ç»ˆæ˜¾ç¤º
            const card = document.createElement('div');
            card.className = 'question-card';
            card.innerHTML = `
                <div class="q-title">${q.q}</div>
                <textarea id="input-${q.id}" placeholder="è¯·åœ¨æ­¤å¤„ä½œç­”..."></textarea>
                <div style="margin-top:15px;">
                    <button class="check-btn" onclick="checkWriting(${q.id})">æäº¤ä½œæ–‡</button>
                </div>
                <div class="analysis-box" id="exp-${q.id}">
                    ${q.exp}
                    <div style="margin-top:10px; background:#eee; padding:10px; border-radius:4px;">
                        <strong>èŒƒæ–‡å†…å®¹ï¼š</strong><br>
                        <pre style="white-space: pre-wrap; font-family:inherit;">${q.ans}</pre>
                    </div>
                </div>
            `;
            container.appendChild(card);
            
            if (userResponses[q.id]) {
                document.getElementById(`input-${q.id}`).value = userResponses[q.id].userVal;
                document.getElementById(`exp-${q.id}`).style.display = 'block';
            }
        });
    }

    // --- äº¤äº’ä¸åˆ¤åˆ† ---

    window.checkChoice = function(btn, id, optStr, ansStr) {
        const parent = btn.parentElement;
        const allBtns = parent.querySelectorAll('button');
        const expDiv = document.getElementById(`exp-${id}`);
        
        allBtns.forEach(b => b.disabled = true);
        
        const isCorrect = optStr.startsWith(ansStr);
        if (isCorrect) {
            btn.classList.add('correct');
            correctIds.add(id);
        } else {
            btn.classList.add('wrong');
            correctIds.delete(id); // ç¡®ä¿é‡ç»ƒé€»è¾‘
            // æ˜¾ç¤ºæ­£ç¡®é€‰é¡¹
            allBtns.forEach(b => {
                if(b.innerText.startsWith(ansStr)) b.classList.add('correct');
            });
        }
        
        expDiv.style.display = 'block';
        userResponses[id] = { type: 'choice', userChoice: optStr.charAt(0), isCorrect: isCorrect, ans: ansStr };
    };

    function restoreChoiceState(card, id, ansStr) {
        const btns = card.querySelectorAll('.option-btn');
        const exp = card.querySelector('.analysis-box');
        const userChoice = userResponses[id].userChoice;
        
        btns.forEach(btn => {
            btn.disabled = true;
            if(btn.innerText.startsWith(ansStr)) btn.classList.add('correct');
            if(btn.innerText.startsWith(userChoice) && !btn.innerText.startsWith(ansStr)) btn.classList.add('wrong');
        });
        exp.style.display = 'block';
    }

    window.checkInput = function(id, correctAns) {
        const input = document.getElementById(`input-${id}`);
        const expDiv = document.getElementById(`exp-${id}`);
        if(!input) return; // é”™é¢˜æ¨¡å¼ä¸‹å¯èƒ½ä¸å­˜åœ¨
        const userVal = input.value.trim();
        
        if (!userVal) return alert("è¯·å…ˆå¡«å†™ç­”æ¡ˆï¼");
        
        // å®½æ¾åŒ¹é…é€»è¾‘
        const cleanUser = userVal.toLowerCase().replace(/\s+/g, ' ').replace(/[.,?!]/g, '');
        const cleanAns = correctAns.toLowerCase().replace(/\s+/g, ' ').replace(/[.,?!]/g, '');
        
        // åŒ…å«åˆ¤æ–­æˆ–å…¨ç­‰
        let isCorrect = (cleanUser === cleanAns) || (cleanAns.includes(cleanUser) && cleanUser.length > 3);

        if (isCorrect) {
            input.classList.add('correct');
            correctIds.add(id);
        } else {
            input.classList.add('wrong');
            correctIds.delete(id);
        }
        
        input.disabled = true;
        expDiv.style.display = 'block';
        userResponses[id] = { type: 'input', userVal: userVal, isCorrect: isCorrect };
    };
    
    window.checkWriting = function(id) {
        const input = document.getElementById(`input-${id}`);
        const expDiv = document.getElementById(`exp-${id}`);
        if (!input.value.trim()) return alert("è¯·å…ˆå†™ç‚¹ä»€ä¹ˆå§~");
        
        input.disabled = true;
        expDiv.style.display = 'block';
        userResponses[id] = { type: 'writing', userVal: input.value, isCorrect: true };
    };

    function restoreInputState(questions) {
        questions.forEach(q => {
            if (shouldRenderQuestion(q.id) && userResponses[q.id]) {
                const input = document.getElementById(`input-${q.id}`);
                const exp = document.getElementById(`exp-${q.id}`);
                if (input && exp) {
                    input.value = userResponses[q.id].userVal;
                    input.disabled = true;
                    exp.style.display = 'block';
                    input.classList.add(userResponses[q.id].isCorrect ? 'correct' : 'wrong');
                }
            }
        });
    }

    // --- æäº¤ä¸é‡ç»ƒ ---

    window.submitExam = function() {
        let score = 0;
        // ç®€å•è®¡åˆ†
        Object.values(userResponses).forEach(r => {
            if (r.type === 'writing') score += 15; 
            else if (r.isCorrect) score += (r.type === 'choice' ? 2 : 3);
        });
        
        document.getElementById('final-score').innerText = score;
        document.getElementById('result-modal').style.display = 'flex';
    };

    window.retryWrongMode = function() {
        // 4) é”™é¢˜é‡ç»ƒé€»è¾‘
        isRetryMode = true;
        document.getElementById('result-modal').style.display = 'none';
        
        // æ¸…é™¤é”™é¢˜çš„ä½œç­”è®°å½•ï¼Œä¿ç•™å¯¹é¢˜çš„è®°å½•
        for (let key in userResponses) {
            if (!userResponses[key].isCorrect && userResponses[key].type !== 'writing') {
                delete userResponses[key];
            }
        }
        
        alert("å·²è¿›å…¥ã€é”™é¢˜é‡ç»ƒã€‘æ¨¡å¼ï¼Œåšå¯¹çš„é¢˜ç›®å·²è‡ªåŠ¨éšè—ã€‚");
        showSection(0); // å›åˆ°ç¬¬ä¸€é¢˜
        // åˆ·æ–°èœå•çŠ¶æ€
        document.querySelector('.menu-item').click(); 
    };

</script>
</body>
</html>
